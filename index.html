<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ligar e Desligar</title>
</head>
<body>
  <h2>Controle</h2>
  <button id="btnLigar">Ligar</button>
  <button id="btnDesligar">Desligar</button>

  <p id="status"></p>

  <h3>ğŸ“Š GrÃ¡fico em tempo real</h3>

  <iframe 
    width="450" 
    height="260" 
    style="border: 1px solid #cccccc;" 
    src="https://thingspeak.mathworks.com/channels/3183297/charts/1?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&type=line&update=15">
  </iframe>

  <script>
    const status = document.getElementById("status");

    // FunÃ§Ã£o genÃ©rica para fazer o GET
    function enviarComando(valor) {
      const url = `https://api.thingspeak.com/update?api_key=WTTUCOLHX0BCLCHM&field2=${valor}`;
      
      // Faz o GET sem recarregar
      fetch(url, { method: 'GET' })
        .then(response => {
          
          return response.text();
        })
        .then(data => {
          if (!data) return; // evita erro se jÃ¡ tratou o 304

          status.textContent = valor === 1 
            ? "âœ… Dispositivo LIGADO (field2=1)"
            : "â›” Dispositivo DESLIGADO (field2=0)";
        })
        .catch(error => {
          status.textContent = "Erro: " + error.message;
        });
    }

    // Eventos dos botÃµes
    document.getElementById("btnLigar").addEventListener("click", () => enviarComando(1));
    document.getElementById("btnDesligar").addEventListener("click", () => enviarComando(0));
  </script>
</body>
</html>